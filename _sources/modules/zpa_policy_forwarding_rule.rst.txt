.. _zpa_policy_forwarding_rule_module:


zpa_policy_forwarding_rule - Create/Update/Delete a Policy Forwarding Rule.
===========================================================================

.. contents::
   :local:
   :depth: 1


Synopsis
--------

This module creates a Policy Forwarding rule in the ZPA Cloud.




Requirements
------------
This module requires proper API credentials to be passed statically or via environment variables:

You can provide credentials via the ZPA_CLIENT_ID, ZPA_CLIENT_SECRET, ZPA_CUSTOMER_ID environment variables,
representing your ZPA API key credentials and customer ID, of your ZPA account, respectively.

- `zpa_client_id`
- `zpa_client_secret`
- `zpa_customer_id`

Refer to the following help article: https://help.zscaler.com/zpa/about-api-keys

Parameters
----------

Notes
-----

LHS and RHS values differ based on object types. Refer to the following table: 

.. list-table:: **LHS and RHS Values**
   :widths: 25 25 50
   :header-rows: 1

   * - Object Type
     - LHS
     - RHS
   * - APP
     - "id"
     - <app segment ID>
   * - APP_GROUP
     - "id"
     - <app segment group ID>
   * - CLIENT_TYPE
     - "id"
     - 
      - zpn_client_type_zapp
      - zpn_client_type_exporter
      - zpn_client_type_ip_anchoring
      - zpn_client_type_browser_isolation
      - zpn_client_type_machine_tunnel
      - zpn_client_type_edge_connector
   * - EDGE_CONNECTOR_GROUP
     - "id"
     - <Cloud Connector group ID>
   * - IDP
     - "id"
     - <IdP ID>
   * - MACHINE_GRP
     - "id"
     - <Machine group ID>
   * - POSTURE
     - <posture network ID>
     - "true" / "false"
   * - SAML
     - <SAML attribute ID>
     - <Attribute value to match>
   * - SCIM
     - <SCIM attribute ID>
     - <Attribute value to match>
   * - SCIM_GROUP
     - <SCIM group attribute ID>
     - <Attribute value to match>
   * - TRUSTED_NETWORK
     - <trusted network ID>
     - "true"

Policy Forwarding rules take the following actions:

- INTERCEPT
- BYPASS
- INTERCEPT_ACCESIBLE

Examples
--------

.. code-block:: yaml+jinja

    - name: Get IDP Controller ID
      willguibr.zpacloud.zpa_idp_controller_info:
        name: IdP_Name
      register: idp_controller

    - name: Forwarding Policy - Test
      willguibr.zpacloud.zpa_policy_forwarding_rule:
        name: "Policy Forwarding Rule"
        description: "Policy Forwarding Rule"
        action: "INTERCEPT"
        rule_order: 1
        operator: "AND"
        conditions:
          - negated: false
            operator: "OR"
            operands:
              - name: "Test"
                object_type: "APP"
                lhs: "id"
                rhs: "216196257331292105"
              - name: "All Other Services"
                object_type: "APP_GROUP"
                lhs: "id"
                rhs: "216196257331292103"
          - negated: false
            operator: "OR"
            operands:
              - name: "zpn_client_type_exporter"
                object_type: "CLIENT_TYPE"
                lhs: "id"
                rhs: "zpn_client_type_exporter"
          - negated: false
            operator: "OR"
            operands:
              - name: "CrowdStrike_ZPA_ZTA_80"
                object_type: "POSTURE"
                lhs: "{{ postures.data[0].posture_udid }}"
                rhs: "false"